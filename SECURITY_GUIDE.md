# 系統安全與分享指引

## 1. 核心重點：試算表權限管理

本系統採用 Google Apps Script 執行，當您將專案部署為 Web App 並設定為 **「執行身分：我 (Me)」** 時：

- **正確做法**：您的原始資料試算表 **千萬不可** 開啟「知道連結的人即可檢視」，請將權限保持為「私人」。
- **原因**：Web App 的作用是在「不開放試算表」的情況下，透過程式碼精確地篩選出該使用者所屬的一列資料。如果您將試算表公開，任何人只要取得試算表 ID，就能繞過 Web App 看到所有人的敏感資料。

## 2. 存取權限透明化

部署時，Google 會要求您授權權限，本專案已在 `appsscript.json` 中嚴格限制了最小權限範圍：

- **`spreadsheets`**：僅用於讀取查詢資料。
- **`drive.readonly`**：僅用於「讀取」您的 Logo 圖檔（本專案 **不要求** 寫入或刪除您的雲端硬碟權限）。
- **`script.external_request`**：僅用於向新北市 OpenID 伺服器進行身分驗證。

> [!NOTE]
> **為什麼會看到「Google 尚未驗證此應用程式」？**
> 因為您是這份程式碼的複製品擁有者。除非您向 Google 付費並提交正式的身分審查，否則 Google 都會顯示此提示。這並不代表有安全風險，只需透過「進階 (Advanced)」選項繼續操作即可。

## 3. 學校限制

可以在「環境設定」工作表或 `Config.js` 中設定： 

- **學校名稱**：請填寫您的學校名稱，系統會依此判斷 OpenID 傳回的所屬單位。

## 4. 多處室協同作業

在學校環境中，通常由不同處室（如教務、總務、學務）負責各自的資料。您可以透過以下方式讓各人員「僅能編輯自己的工作表」：

- **保護工作表功能**：
  1. 在下方的分頁標籤點選右鍵 -> **「保護工作表」**。
  2. 點選 **「設定權限」**。
  3. 選擇 **「限制誰可以編輯這個範圍」**，並填入該處室人員的電子郵件。
- **優點**：
  - **權限隔離**：避免不同處室的老師誤動到彼此的資料。
  - **資料安全**：試算表擁有者仍具最高權限，且不影響 OpenID 查詢功能的運作。

## 給架設者的快速檢核清單

當您從本專案建立副本並準備分享時，請檢查以下項目：

1. **試算表權限**：確認試算表為「私人」狀態。
2. **Web App 部署**：執行身分選 `我 (Me)`，誰可以存取選 `任何人 (Anyone)`。
3. **環境設定工作表**：確認學校名稱填寫正確。
4. **實際測試**：請測試帳號登入，確認其僅能看到自己的資料，且無法存取其他人的分頁。
